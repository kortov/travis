language: java
jdk:
  - oraclejdk8
services:
  - docker
  - postgresql
cache:
  directories:
    - $HOME/.m2
    - $HOME/.gradle/caches/
    - $HOME/.gradle/wrapper/
before_script:
  - psql -c "CREATE DATABASE sqlcmd;" -U postgres
  - psql -c "CREATE DATABASE test;" -U postgres
  - psql -c "CREATE USER sqlcmd WITH ENCRYPTED PASSWORD 'sqlcmd' SUPERUSER;" -U postgres
  - sudo sed -i 's/local   all             all                                     trust/local   all             sqlcmd                                     md5/g' /etc/postgresql/9.6/main/pg_hba.conf
  - sudo service postgresql restart
  - sudo cat /etc/postgresql/9.6/main/pg_hba.conf
  - psql -c "GRANT ALL PRIVILEGES ON DATABASE sqlcmd TO sqlcmd;" -U postgres
  - psql -c "GRANT ALL PRIVILEGES ON DATABASE test TO sqlcmd;" -U postgres
test:
  adapter: postgresql
  database: sqlcmd
addons:
  postgresql: "9.6"